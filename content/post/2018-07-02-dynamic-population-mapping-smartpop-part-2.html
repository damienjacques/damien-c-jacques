---
title: Dynamic Population Mapping (Smartpop) - Part 2
author: Damien C. Jacques
date: '2018-07-02'
slug: dynamic-population-mapping-smartpop-part-2
categories:
  - R
summary: "This Notebook details the steps of the data analysis carried out for the Smartpop project -- Dynamic Population WP (part 2)."
tags:
  - mobile phone data
  - population
---



<div id="antenna-coverage" class="section level2">
<h2>Antenna coverage</h2>
<pre class="r"><code># extract all unique combination of antenna per

# compute Voronoi polygons of selected antennas
library(SDraw)

belgium &lt;- getData(&#39;GADM&#39;, country = &#39;BE&#39;, level = 4)
belgium &lt;- spTransform(belgium, crs(antenna_shp_select))

voro &lt;- voronoi.polygons(antenna_shp_select, belgium)

par(mar = c(0, 0, 0, 0))
plot(voro)
colnames(voro@data)[1:2] &lt;- c(&quot;X&quot;, &quot;Y&quot;)
voro@data &lt;- plyr::join(voro@data, antenna_shp_select@data, by = c(&quot;X&quot;, &quot;Y&quot;))

# find discarded points that falls within the voronoi
antennaDiscardInVoro  &lt;- over(antenna_shp_discard, voro)
lookUp &lt;- data.frame(OldID = row.names(antennaDiscardInVoro), NewID = antennaDiscardInVoro$ID)

# Replace IDs in the full db and antenna shapefile
Mobile_Phone$ID[Mobile_Phone$ID %in% lookUp$OldID]  &lt;- lookUp$NewID[na.omit(match(Mobile_Phone$ID, lookUp$OldID))]
antenna_shp  &lt;- antenna_shp[-which(antenna_shp$ID %in% lookUp$OldID), ] 

# Merge alls identical id (summarise)
library(dplyr)
Mobile_Phone &lt;- Mobile_Phone %&gt;%
                group_by(DATE_HOUR, ID) %&gt;%
                summarise(NBR_SIM_BE = sum(NBR_SIM_BE),
                          NBR_SIM_ROAMERS = sum(NBR_SIM_ROAMERS),
                          NBR_EVENTS_BE = sum(NBR_EVENTS_BE),
                          NBR_EVENTS_ROAMERS = sum(NBR_EVENTS_ROAMERS))</code></pre>
<pre class="r"><code>UniqueByDay &lt;- Mobile_Phone %&gt;%                   
                 group_by(substr(DATE_HOUR, 1, 10)) %&gt;%          
                 summarise(Unique_Elements = n_distinct(ID))

plot(1:nrow(UniqueByDay), 
     UniqueByDay$Unique_Elements, 
     type = &quot;l&quot;, 
     xlab = &quot;day&quot;, ylab = &quot;Unique antenna&quot;)</code></pre>
</div>
